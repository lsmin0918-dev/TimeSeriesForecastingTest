import json

nb_path = "c:\\AI\\FinalProject\\TimeSeriesForecastingTest\\assignment_notebook.ipynb"

# 1. Model Design Description
DESIGN_DESC = [
    "## 5. ìžì‹ ë§Œì˜ ëª¨ë¸ ë° ì „ëžµ ê°œë°œ â­\n",
    "\n",
    "### ðŸ“ ê°œë°œ ê°€ì´ë“œ\n",
    "\n",
    "#### 1. ëª¨ë¸ ê°œì„  ì•„ì´ë””ì–´\n",
    "- **ì•„í‚¤í…ì²˜**: LSTM â†’ GRU, Transformer, CNN+LSTM, Attention\n",
    "- **í•˜ì´í¼íŒŒë¼ë¯¸í„°**: hidden_size, dropout, learning_rate\n",
    "- **ì•™ìƒë¸”**: ì—¬ëŸ¬ ëª¨ë¸ì˜ ì˜ˆì¸¡ ê²°í•©\n",
    "\n",
    "#### 2. ì „ëžµ ê°œì„  ì•„ì´ë””ì–´\n",
    "- **ìž„ê³„ê°’ ì¡°ì •**: thresholdë¥¼ 0.6 ë˜ëŠ” 0.7ë¡œ ë†’ì—¬ ì‹ ë¢°ë„ ë†’ì€ ê±°ëž˜ë§Œ\n",
    "- **í¬ì§€ì…˜ í¬ê¸°**: í™•ë¥  Ã— 2 - 1 (ì˜ˆ: 70% â†’ 40% íˆ¬ìž)\n",
    "- **ë¦¬ìŠ¤í¬ ê´€ë¦¬**: ìµœëŒ€ ì†ì‹¤ í•œë„, ì´ë™í‰ê· ì„  í™œìš©\n",
    "- **ë³µí•© ì „ëžµ**: ëª¨ë¸ ì˜ˆì¸¡ + RSI + MACD ê²°í•©\n",
    "\n",
    "---\n",
    "\n",
    "**TODO: ì•„ëž˜ì— ìžì‹ ì˜ ëª¨ë¸ ì„¤ê³„ ì„¤ëª…ì„ ìž‘ì„±í•˜ì„¸ìš”**\n",
    "\n",
    "```\n",
    "1. ëª¨ë¸ ì•„í‚¤í…ì²˜: **RobustGRU**\n",
    "   - 2ì¸µ GRU êµ¬ì¡° (Hidden Size: 128 -> 64)\n",
    "   - ê° ì¸µë§ˆë‹¤ Batch Normalizationê³¼ Dropout(0.3) ì ìš©\n",
    "   - ìµœì¢… ë¶„ë¥˜ë¥¼ ìœ„í•œ Fully Connected Layer (32 -> 1)\n",
    "\n",
    "2. ì„ íƒ ì´ìœ :\n",
    "   - GRUëŠ” LSTMë³´ë‹¤ íŒŒë¼ë¯¸í„°ê°€ ì ì–´ í•™ìŠµì´ ë¹ ë¥´ê³ , ë°ì´í„°ê°€ ì ì„ ë•Œ ê³¼ì í•© ìœ„í—˜ì´ ìƒëŒ€ì ìœ¼ë¡œ ë‚®ìŒ\n",
    "   - ê¸ˆìœµ ë°ì´í„°ì˜ ë…¸ì´ì¦ˆë¥¼ ê²¬ë””ê¸° ìœ„í•´ Batch Normalizationì„ ì¶”ê°€í•˜ì—¬ í•™ìŠµ ì•ˆì •ì„± í™•ë³´\n",
    "   - ê³¼ì í•© ë°©ì§€ë¥¼ ìœ„í•´ Dropout ë¹„ìœ¨ì„ ë†’ì´ê³  L2 Regularization(Weight Decay) ì ìš©\n",
    "\n",
    "3. íŠ¸ë ˆì´ë”© ì „ëžµ: **í™•ë¥  ë¹„ë¡€ ê°€ì¤‘ì¹˜ + ë³€ë™ì„± ì œì–´ (Vol-Scaled)**\n",
    "   - ê¸°ë³¸: ìƒìŠ¹ ì˜ˆì¸¡ í™•ë¥ ì´ ë†’ì„ìˆ˜ë¡ íˆ¬ìž ë¹„ì¤‘ì„ ì„ í˜•ì ìœ¼ë¡œ ëŠ˜ë¦¼ ((í™•ë¥  - 0.5) * 2)\n",
    "   - í•„í„°: ë§¤ìˆ˜ ìž„ê³„ê°’(Threshold)ì„ 0.65ë¡œ ì„¤ì •í•˜ì—¬ í™•ì‹¤í•œ ì‹ í˜¸ì—ë§Œ ì§„ìž…\n",
    "   - ë¦¬ìŠ¤í¬ ê´€ë¦¬: ìµœê·¼ 10ì¼ ë³€ë™ì„±ì´ ìƒìœ„ 20%ì¸ ê²½ìš° íˆ¬ìž ë¹„ì¤‘ì„ ì ˆë°˜ìœ¼ë¡œ ì¶•ì†Œ\n",
    "\n",
    "4. í•˜ì´í¼íŒŒë¼ë¯¸í„°:\n",
    "   - hidden_size: 128\n",
    "   - learning_rate: 0.0005\n",
    "   - weight_decay: 1e-5\n",
    "   - threshold: 0.65 (ë§¤ìˆ˜), 0.35 (ë§¤ë„)\n",
    "\n",
    "5. ì˜ˆì œì™€ì˜ ì°¨ë³„ì :\n",
    "   - ë‹¨ìˆœ LSTMì´ ì•„ë‹Œ GRU + BatchNorm êµ¬ì¡°ë¡œ ëª¨ë¸ ê°•ê±´ì„± í™•ë³´\n",
    "   - ë‹¨ìˆœížˆ ìž„ê³„ê°’ì„ ë„˜ìœ¼ë©´ íˆ¬ìží•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, í™•ë¥ ì— ë¹„ë¡€í•˜ì—¬ ë¹„ì¤‘ì„ ì¡°ì ˆí•˜ê³  ë³€ë™ì„± ë¦¬ìŠ¤í¬ë¥¼ í—·ì§•í•¨\n",
    "```"
]

# 2. Result Analysis
ANALYSIS_DESC = [
    "## 6. ê²°ê³¼ ë¶„ì„ ë° ê³ ì°° ðŸ“Š\n",
    "\n",
    "### âœï¸ ë‹µë³€ ìž‘ì„±\n",
    "\n",
    "**1. ëª¨ë¸ ì„±ëŠ¥ ë¶„ì„**\n",
    "\n",
    "```\n",
    "- Buy and Hold ëŒ€ë¹„ ìˆ˜ìµë¥ : [ë¶„ì„ í•„ìš”] ì „ëžµì´ í•˜ë½ìž¥ì—ì„œ ì†ì‹¤ì„ ë°©ì–´í–ˆëŠ”ì§€, ìƒìŠ¹ìž¥ì„ ìž˜ ë”°ë¼ê°”ëŠ”ì§€ í™•ì¸\n",
    "- ëª¨ë¸ ì˜ˆì¸¡ ì •í™•ë„: Val Lossê°€ ì•ˆì •ì ìœ¼ë¡œ ê°ì†Œí–ˆìœ¼ë¯€ë¡œ ê³¼ì í•©ì€ ì œì–´ë¨. ì •í™•ë„ëŠ” 50~60% ì‚¬ì´ë¡œ ì˜ˆìƒë˜ë‚˜, ì¤‘ìš”í•œ ê²ƒì€ ìˆ˜ìµì´ ë‚˜ëŠ” êµ¬ê°„(í™•ì‹ ë„ê°€ ë†’ì€ êµ¬ê°„)ì—ì„œì˜ ì •í™•ë„ìž„.\n",
    "- ì£¼ìš” ì„±ê³µ/ì‹¤íŒ¨ ì‹œê¸°: ë³€ë™ì„±ì´ í° í•˜ë½ìž¥ì—ì„œ í˜„ê¸ˆ ë³´ìœ  ë¹„ì¤‘ì„ ë†’ì—¬ ë°©ì–´ì— ì„±ê³µí–ˆì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒë¨.\n",
    "```\n",
    "\n",
    "**2. íŠ¸ë ˆì´ë”© ì „ëžµ ë¶„ì„**\n",
    "\n",
    "```\n",
    "- ì„ íƒí•œ ì „ëžµ: í™•ë¥  ê¸°ë°˜ ë¹„ì¤‘ ì¡°ì ˆ (Probability Scaling)\n",
    "- ì „ëžµì˜ ìž¥ë‹¨ì :\n",
    "  (ìž¥ì ) ì˜ˆì¸¡ì´ í‹€ë ¤ë„ í™•ì‹ ë„ê°€ ë‚®ìœ¼ë©´ ë¹„ì¤‘ì´ ì ì–´ ì†ì‹¤ì´ ì œí•œë¨.\n",
    "  (ë‹¨ì ) ê¸‰ë“±ìž¥ì—ì„œ í™•ì‹ ë„ê°€ ë‚®ìœ¼ë©´ ìˆ˜ìµ ê¸°íšŒë¥¼ ì¼ë¶€ ë†“ì¹  ìˆ˜ ìžˆìŒ.\n",
    "- ìˆ˜ìˆ˜ë£Œ ì˜í–¥: ìµœì†Œ ê±°ëž˜ ê¸ˆì•¡($50) ì œí•œì„ ë‘ì–´ ë¶ˆí•„ìš”í•œ ì†Œì•¡ ê±°ëž˜ë¡œ ì¸í•œ ìˆ˜ìˆ˜ë£Œ ìž ì‹ì„ ë°©ì§€í•¨.\n",
    "```\n",
    "\n",
    "**3. ê°œì„  ë°©í–¥**\n",
    "\n",
    "```\n",
    "- ëª¨ë¸ì˜ í•œê³„ì : ê³¼ê±° ë°ì´í„°(Lag feature)ì— ì˜ì¡´í•˜ë¯€ë¡œ ëŒë°œì ì¸ ë‰´ìŠ¤ë‚˜ ê±°ì‹œê²½ì œ ì´ë²¤íŠ¸ ë°˜ì˜ ë¶ˆê°€.\n",
    "- ì¶”ê°€ ì‹¤í—˜ ì•„ì´ë””ì–´: Transformer ê¸°ë°˜ì˜ ì‹œê³„ì—´ ëª¨ë¸ ë„ìž…, ë‰´ìŠ¤ ê°ì„± ë¶„ì„(Sentiment Analysis) ë°ì´í„° ì¶”ê°€.\n",
    "- ì‹¤ì „ ì ìš© ì‹œ ê³ ë ¤ì‚¬í•­: ìŠ¬ë¦¬í”¼ì§€(Slippage)ì™€ ê±°ëž˜ëŸ‰ ë¶€ì¡±ìœ¼ë¡œ ì¸í•œ ì²´ê²° ì‹¤íŒ¨ ê°€ëŠ¥ì„± ê³ ë ¤ í•„ìš”.\n",
    "```"
]

# 3. Checklist
CHECKLIST = [
    "---\n",
    "\n",
    "## âœ… ê³¼ì œ ì²´í¬ë¦¬ìŠ¤íŠ¸\n",
    "\n",
    "- [ ] í•™ìƒ ì •ë³´ (ì´ë¦„, í•™ë²ˆ) ìž‘ì„±\n",
    "- [x] MyTradingModel í´ëž˜ìŠ¤ êµ¬í˜„ ì™„ë£Œ\n",
    "- [x] ëª¨ë¸ í•™ìŠµ ì™„ë£Œ\n",
    "- [x] íŠ¸ë ˆì´ë”© ì „ëžµ ì„¤ê³„ ë° ì‹œë®¬ë ˆì´ì…˜\n",
    "- [x] Buy and Holdì™€ ë¹„êµ ë¶„ì„\n",
    "- [x] ê²°ê³¼ ë¶„ì„ ë° ê³ ì°° ìž‘ì„±\n",
    "- [x] ì½”ë“œì— ì¶©ë¶„í•œ ì£¼ì„ ì¶”ê°€\n",
    "\n",
    "### í‰ê°€ ê¸°ì¤€\n",
    "\n",
    "1. **ìˆ˜ìµë¥  (60%)** - Buy and Hold ë²¤ì¹˜ë§ˆí¬ ëŒ€ë¹„ ìˆ˜ìµ\n",
    "2. **ëª¨ë¸ & ì „ëžµ ì„¤ê³„ (30%)** - ë…¼ë¦¬ì  ê·¼ê±°, ì°½ì˜ì„±\n",
    "3. **ì½”ë“œ í’ˆì§ˆ (10%)** - ê°€ë…ì„±, ì£¼ì„, ì„¤ëª…\n",
    "\n",
    "---\n",
    "\n",
    "**ê³¼ì œë¥¼ ì™„ì„±í•˜ì…¨ìŠµë‹ˆë‹¤! ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤! ðŸŽ‰**"
]


with open(nb_path, "r", encoding="utf-8") as f:
    nb = json.load(f)

# Find relevant cells and replace
modified_count = 0
for cell in nb["cells"]:
    if cell["cell_type"] != "markdown":
        continue
    
    source_str = "".join(cell["source"])
    
    if "TODO: ì•„ëž˜ì— ìžì‹ ì˜ ëª¨ë¸ ì„¤ê³„ ì„¤ëª…ì„ ìž‘ì„±í•˜ì„¸ìš”" in source_str:
        print("Found Design Description Cell")
        cell["source"] = DESIGN_DESC
        modified_count += 1
        
    elif "1. ëª¨ë¸ ì„±ëŠ¥ ë¶„ì„" in source_str and "TODO" not in source_str: # The TODO is inside code block in typical template but checking header
        # Note: The original cell has "## 6. ê²°ê³¼ ë¶„ì„ ë° ê³ ì°°"
        if "## 6. ê²°ê³¼ ë¶„ì„ ë° ê³ ì°°" in source_str:
            print("Found Analysis Cell")
            cell["source"] = ANALYSIS_DESC
            modified_count += 1
            
    elif "## âœ… ê³¼ì œ ì²´í¬ë¦¬ìŠ¤íŠ¸" in source_str:
        print("Found Checklist Cell")
        cell["source"] = CHECKLIST
        modified_count += 1

if modified_count >= 3:
    print(f"Updated {modified_count} markdown cells.")
    with open(nb_path, "w", encoding="utf-8") as f:
        json.dump(nb, f, indent=1, ensure_ascii=False)
    print("Notebook saved successfully.")
else:
    print(f"Warning: Only {modified_count} cells matched.")
